\hypertarget{model_8h_source}{}\doxysection{model.\+h}
\label{model_8h_source}\index{/github/workspace/multibody/include/huron/multibody/model.h@{/github/workspace/multibody/include/huron/multibody/model.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <unordered\_map>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include "{}huron/multibody/model\_impl\_types.h"{}}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}huron/multibody/model\_impl\_interface.h"{}}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}huron/multibody/frame.h"{}}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacehuron}{huron}} \{}
\DoxyCodeLine{14 \textcolor{keyword}{namespace }multibody \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{class }\mbox{\hyperlink{classhuron_1_1multibody_1_1Model}{Model}} : \textcolor{keyword}{public} std::enable\_shared\_from\_this<Model> \{}
\DoxyCodeLine{17   \textcolor{keyword}{using }\mbox{\hyperlink{classhuron_1_1multibody_1_1internal_1_1ModelImplInterface}{ModelImplInterface}} = \mbox{\hyperlink{classhuron_1_1multibody_1_1internal_1_1ModelImplInterface}{internal::ModelImplInterface}};}
\DoxyCodeLine{18 }
\DoxyCodeLine{19  \textcolor{keyword}{public}:}
\DoxyCodeLine{20   \mbox{\hyperlink{classhuron_1_1multibody_1_1Model}{Model}}();}
\DoxyCodeLine{21   \mbox{\hyperlink{classhuron_1_1multibody_1_1Model}{Model}}(\textcolor{keyword}{const} \mbox{\hyperlink{classhuron_1_1multibody_1_1Model}{Model}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{22   \mbox{\hyperlink{classhuron_1_1multibody_1_1Model}{Model}}\& operator=(\textcolor{keyword}{const} \mbox{\hyperlink{classhuron_1_1multibody_1_1Model}{Model}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{23   \mbox{\hyperlink{classhuron_1_1multibody_1_1Model}{\string~Model}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{24 }
\DoxyCodeLine{33   \textcolor{keywordtype}{void} \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a041785cccdbfe069d6fccf2218a41333}{AddModelImpl}}(ModelImplType type, \textcolor{keywordtype}{bool} set\_as\_default = \textcolor{keyword}{false});}
\DoxyCodeLine{34 }
\DoxyCodeLine{41   \textcolor{keyword}{template}<\textcolor{keyword}{typename} ...Args>}
\DoxyCodeLine{42   \textcolor{keywordtype}{void} \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a8df9e2a9af40c39411af8bfbc782a60c}{AddJoint}}(JointIndex index,}
\DoxyCodeLine{43                        Args\&\&... args) \{}
\DoxyCodeLine{44     assert(!is\_constructed\_);}
\DoxyCodeLine{45     assert(!is\_finalized\_);}
\DoxyCodeLine{46     \textcolor{keywordflow}{if} (joints\_[index] != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{47       \textcolor{comment}{// TODO(dtbpkmte): provide index information in the error message.}}
\DoxyCodeLine{48       \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Joint already exists at this index."{}});}
\DoxyCodeLine{49     \}}
\DoxyCodeLine{50     joints\_[index] = std::make\_shared<Joint>(std::forward<Args>(args)...);}
\DoxyCodeLine{51   \}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53   \mbox{\hyperlink{classhuron_1_1Joint}{Joint}}* \textcolor{keyword}{const} GetJoint(JointIndex index);}
\DoxyCodeLine{54   \mbox{\hyperlink{classhuron_1_1Joint}{Joint}}* \textcolor{keyword}{const} GetJoint(\textcolor{keyword}{const} std::string\& name);}
\DoxyCodeLine{55 }
\DoxyCodeLine{56   \textcolor{keywordtype}{void} SetJointStateProvider(JointIndex index,}
\DoxyCodeLine{57                              std::shared\_ptr<StateProvider> state\_provider);}
\DoxyCodeLine{58 }
\DoxyCodeLine{59   JointIndex GetJointIndex(\textcolor{keyword}{const} std::string\& joint\_name) \textcolor{keyword}{const};}
\DoxyCodeLine{71   \textcolor{comment}{// template<typename FrameImpl, typename ...Args>}}
\DoxyCodeLine{72   \textcolor{comment}{// std::weak\_ptr<const Frame>}}
\DoxyCodeLine{73   \textcolor{comment}{// AddFrame(const std::string\& name, Args\&\&... args);}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75   \textcolor{keyword}{template}<\textcolor{keyword}{typename} FrameImpl, \textcolor{keyword}{typename} ...Args>}
\DoxyCodeLine{76   std::weak\_ptr<const Frame> \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_abcb87adec0f790a39fdbb22ace4a5f0d}{AddFrame}}(\textcolor{keyword}{const} std::string\& name, Args\&\&... args) \{}
\DoxyCodeLine{77     \textcolor{keyword}{static\_assert}(}
\DoxyCodeLine{78       std::is\_base\_of\_v<Frame, FrameImpl>,}
\DoxyCodeLine{79       \textcolor{stringliteral}{"{}Invalid frame type."{}});}
\DoxyCodeLine{80     \textcolor{keyword}{static\_assert}(}
\DoxyCodeLine{81       std::is\_base\_of\_v<enable\_protected\_make\_shared<FrameImpl>, FrameImpl>,}
\DoxyCodeLine{82       \textcolor{stringliteral}{"{}Frame-\/derived class must also derive from "{}}}
\DoxyCodeLine{83       \textcolor{stringliteral}{"{}enable\_protected\_make\_shared."{}});}
\DoxyCodeLine{84     assert(is\_constructed\_);}
\DoxyCodeLine{85     assert(!is\_finalized\_);}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     DoAddFrame<FrameImpl>(name, \textcolor{keyword}{true}, std::forward<Args>(args)...);}
\DoxyCodeLine{88     \textcolor{keywordflow}{return} \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a7075e98c8a43f2b9533cb6bed4b941b3}{frames\_}}.back();}
\DoxyCodeLine{89   \}}
\DoxyCodeLine{90 }
\DoxyCodeLine{91   std::weak\_ptr<const Frame> GetFrame(FrameIndex index) \textcolor{keyword}{const};}
\DoxyCodeLine{92   std::weak\_ptr<const Frame> GetFrame(\textcolor{keyword}{const} std::string\& name) \textcolor{keyword}{const};}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   \textcolor{keywordtype}{void} BuildFromUrdf(\textcolor{keyword}{const} std::string\& urdf\_path,}
\DoxyCodeLine{95                      JointType root\_joint\_type = JointType::kFixed);}
\DoxyCodeLine{96 }
\DoxyCodeLine{104   \textcolor{keywordtype}{void} Finalize(\textcolor{keyword}{const} Eigen::VectorXd\& initial\_state);}
\DoxyCodeLine{105   \textcolor{keywordtype}{void} Finalize();}
\DoxyCodeLine{106 }
\DoxyCodeLine{110   \textcolor{keywordtype}{void} \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_aaa45684d7dd6c02240842a5d5b422a99}{UpdateJointStates}}();}
\DoxyCodeLine{111 }
\DoxyCodeLine{112   \textcolor{keywordtype}{void} SetDefaultModelImpl(\textcolor{keywordtype}{size\_t} index) \{}
\DoxyCodeLine{113     default\_impl\_index\_ = index;}
\DoxyCodeLine{114   \}}
\DoxyCodeLine{115   \textcolor{keywordtype}{size\_t} GetDefaultModelImpl()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{116     \textcolor{keywordflow}{return} default\_impl\_index\_;}
\DoxyCodeLine{117   \}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 }
\DoxyCodeLine{120   \textcolor{comment}{// Kinematics and Dynamics wrapper functions}}
\DoxyCodeLine{121   Eigen::Affine3d GetJointTransformInWorld(\textcolor{keywordtype}{size\_t} joint\_index) \textcolor{keyword}{const};}
\DoxyCodeLine{122 }
\DoxyCodeLine{123   FrameIndex GetFrameIndex(\textcolor{keyword}{const} std::string\& frame\_name) \textcolor{keyword}{const};}
\DoxyCodeLine{124   \textcolor{keyword}{const} std::string\& GetFrameName(FrameIndex frame\_index) \textcolor{keyword}{const};}
\DoxyCodeLine{125   Eigen::Affine3d GetFrameTransform(FrameIndex from\_frame,}
\DoxyCodeLine{126                                     FrameIndex to\_frame) \textcolor{keyword}{const};}
\DoxyCodeLine{127   Eigen::Affine3d GetFrameTransformInWorld(FrameIndex frame) \textcolor{keyword}{const};}
\DoxyCodeLine{128 }
\DoxyCodeLine{129   Eigen::VectorXd NeutralConfiguration() \textcolor{keyword}{const};}
\DoxyCodeLine{130 }
\DoxyCodeLine{131   Eigen::Vector3d EvalCenterOfMassPosition();}
\DoxyCodeLine{132   Eigen::Vector3d GetCenterOfMassPosition() \textcolor{keyword}{const};}
\DoxyCodeLine{133 }
\DoxyCodeLine{134   \textcolor{keyword}{const} Eigen::VectorBlock<const Eigen::VectorXd> GetPositions() \textcolor{keyword}{const};}
\DoxyCodeLine{135 }
\DoxyCodeLine{136   \textcolor{keyword}{const} Eigen::VectorBlock<const Eigen::VectorXd> GetVelocities() \textcolor{keyword}{const};}
\DoxyCodeLine{137 }
\DoxyCodeLine{141   \textcolor{keyword}{const} Eigen::VectorXd\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a5d788e1c9f5ea4556e23a25f6a917d4e}{GetAccelerations}}() \textcolor{keyword}{const};}
\DoxyCodeLine{142 }
\DoxyCodeLine{146   \textcolor{keyword}{const} Eigen::VectorXd\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_adedc8fa3ff775c24ea08973747487133}{GetTorques}}() \textcolor{keyword}{const};}
\DoxyCodeLine{147 }
\DoxyCodeLine{151   \textcolor{keyword}{const} Eigen::MatrixXd\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a9ebd32454dd68827fcfefafc9fb5dd93}{GetMassMatrix}}() \textcolor{keyword}{const};}
\DoxyCodeLine{152 }
\DoxyCodeLine{156   \textcolor{keyword}{const} Eigen::MatrixXd\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a6ba6c6f116d33655c7f6e9a7c67b60c3}{GetCoriolisMatrix}}() \textcolor{keyword}{const};}
\DoxyCodeLine{157 }
\DoxyCodeLine{161   \textcolor{keyword}{const} Eigen::VectorXd\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a9c3956fc2372e9388bea96ff4b42c667}{GetNonlinearEffects}}() \textcolor{keyword}{const};}
\DoxyCodeLine{162 }
\DoxyCodeLine{166   \textcolor{keyword}{const} Eigen::VectorXd\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a343a22f4e16df5e2017885c33f7f7212}{GetGravity}}() \textcolor{keyword}{const};}
\DoxyCodeLine{167 }
\DoxyCodeLine{171   \textcolor{keyword}{const} huron::Vector6d\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_aad747f096a1ca2c9de8aee4141b6fb11}{GetSpatialMomentum}}() \textcolor{keyword}{const};}
\DoxyCodeLine{172 }
\DoxyCodeLine{176   huron::Vector6d \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_af579f84acaeefcc22a1c3c31da463f1d}{GetCentroidalMomentum}}() \textcolor{keyword}{const};}
\DoxyCodeLine{177 }
\DoxyCodeLine{181   \textcolor{keyword}{const} huron::Matrix6Xd\& \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_adf423cbc5b810a24abcc759719221791}{GetCentroidalMatrix}}() \textcolor{keyword}{const};}
\DoxyCodeLine{182 }
\DoxyCodeLine{183   \textcolor{keywordtype}{void} ComputeAll();}
\DoxyCodeLine{184 }
\DoxyCodeLine{185   \textcolor{keywordtype}{void} ForwardKinematics();}
\DoxyCodeLine{186 }
\DoxyCodeLine{187   \textcolor{keywordtype}{bool} is\_finalized()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{188     \textcolor{keywordflow}{return} is\_finalized\_;}
\DoxyCodeLine{189   \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191   \textcolor{keywordtype}{size\_t} num\_positions()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{192     \textcolor{keywordflow}{return} num\_positions\_;}
\DoxyCodeLine{193   \}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195   \textcolor{keywordtype}{size\_t} num\_velocities()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{196     \textcolor{keywordflow}{return} num\_velocities\_;}
\DoxyCodeLine{197   \}}
\DoxyCodeLine{198 }
\DoxyCodeLine{199   \textcolor{keywordtype}{size\_t} num\_joints()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{200     \textcolor{keywordflow}{return} joints\_.size();}
\DoxyCodeLine{201   \}}
\DoxyCodeLine{202 }
\DoxyCodeLine{203   \textcolor{keywordtype}{size\_t} num\_frames()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{204     \textcolor{keywordflow}{return} \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a7075e98c8a43f2b9533cb6bed4b941b3}{frames\_}}.size();}
\DoxyCodeLine{205   \}}
\DoxyCodeLine{206 }
\DoxyCodeLine{207  \textcolor{keyword}{protected}:}
\DoxyCodeLine{212   ModelImplInterface \textcolor{keyword}{const} * \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_aba38ad6497ceb77a56b8148faeaeba1b}{GetModelImpl}}(\textcolor{keywordtype}{size\_t} index) \textcolor{keyword}{const};}
\DoxyCodeLine{213 }
\DoxyCodeLine{214   \textcolor{comment}{// template<typename FrameImpl, typename ...Args>}}
\DoxyCodeLine{215   \textcolor{comment}{// void DoAddFrame(const std::string\& name, bool is\_user\_defined,}}
\DoxyCodeLine{216   \textcolor{comment}{//                 Args\&\&... args);}}
\DoxyCodeLine{217   \textcolor{keyword}{template}<\textcolor{keyword}{typename} FrameImpl, \textcolor{keyword}{typename} ...Args>}
\DoxyCodeLine{218   \textcolor{keywordtype}{void} DoAddFrame(\textcolor{keyword}{const} std::string\& name, \textcolor{keywordtype}{bool} is\_user\_defined,}
\DoxyCodeLine{219                           Args\&\&... args) \{}
\DoxyCodeLine{220     \textcolor{comment}{// Check if the frame name already exists}}
\DoxyCodeLine{221     \textcolor{keywordflow}{if} (frame\_name\_to\_index\_.find(name) != frame\_name\_to\_index\_.end()) \{}
\DoxyCodeLine{222       \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Frame name already exists."{}});}
\DoxyCodeLine{223     \}}
\DoxyCodeLine{224     \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a7075e98c8a43f2b9533cb6bed4b941b3}{frames\_}}.push\_back(FrameImpl::make\_shared(}
\DoxyCodeLine{225                         \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a7075e98c8a43f2b9533cb6bed4b941b3}{frames\_}}.size(),  \textcolor{comment}{// frame index}}
\DoxyCodeLine{226                         name,  \textcolor{comment}{// frame name}}
\DoxyCodeLine{227                         is\_user\_defined,}
\DoxyCodeLine{228                         weak\_from\_this(),  \textcolor{comment}{// model}}
\DoxyCodeLine{229                         std::forward<Args>(args)...));}
\DoxyCodeLine{230     frame\_name\_to\_index\_[name] = \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a7075e98c8a43f2b9533cb6bed4b941b3}{frames\_}}.size() -\/ 1;}
\DoxyCodeLine{231   \}}
\DoxyCodeLine{232 }
\DoxyCodeLine{233   \textcolor{keywordtype}{void} DoAddFrameFromModelDescription(FrameIndex idx,}
\DoxyCodeLine{234                                       \textcolor{keyword}{const} std::string\& name,}
\DoxyCodeLine{235                                       FrameType type);}
\DoxyCodeLine{236 }
\DoxyCodeLine{237   \textcolor{keywordtype}{size\_t} default\_impl\_index\_ = 0;}
\DoxyCodeLine{238   std::vector<std::unique\_ptr<ModelImplInterface>> impls\_;}
\DoxyCodeLine{239   std::vector<std::shared\_ptr<Joint>> joints\_;}
\DoxyCodeLine{241   Eigen::VectorXd \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a1692692b523ba8133f920ec4c064af09}{states\_}};}
\DoxyCodeLine{242   \textcolor{keywordtype}{size\_t} num\_positions\_ = 0;}
\DoxyCodeLine{243   \textcolor{keywordtype}{size\_t} num\_velocities\_ = 0;}
\DoxyCodeLine{244 }
\DoxyCodeLine{247   std::vector<std::shared\_ptr<Frame>> \mbox{\hyperlink{classhuron_1_1multibody_1_1Model_a7075e98c8a43f2b9533cb6bed4b941b3}{frames\_}};}
\DoxyCodeLine{248   std::unordered\_map<std::string, FrameIndex> frame\_name\_to\_index\_;}
\DoxyCodeLine{249 }
\DoxyCodeLine{250   \textcolor{keywordtype}{bool} is\_constructed\_ = \textcolor{keyword}{false};}
\DoxyCodeLine{251   \textcolor{keywordtype}{bool} is\_finalized\_ = \textcolor{keyword}{false};}
\DoxyCodeLine{252 \};}
\DoxyCodeLine{253 }
\DoxyCodeLine{254 \}  \textcolor{comment}{// namespace multibody}}
\DoxyCodeLine{255 \}  \textcolor{comment}{// namespace huron}}

\end{DoxyCode}
