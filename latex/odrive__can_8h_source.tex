\hypertarget{odrive__can_8h_source}{}\doxysection{odrive\+\_\+can.\+h}
\label{odrive__can_8h_source}\index{/github/workspace/system/odrive/include/huron/odrive/odrive\_can.h@{/github/workspace/system/odrive/include/huron/odrive/odrive\_can.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}odrive.h"{}}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}huron/driver/can/canbus.h"{}}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacehuron}{huron}} \{}
\DoxyCodeLine{14 \textcolor{keyword}{namespace }odrive \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{class }\mbox{\hyperlink{classhuron_1_1odrive_1_1ODriveCAN}{ODriveCAN}} : \textcolor{keyword}{public} \mbox{\hyperlink{classhuron_1_1odrive_1_1ODrive}{ODrive}} \{}
\DoxyCodeLine{17  \textcolor{keyword}{private}:}
\DoxyCodeLine{18   \textcolor{keyword}{static} \textcolor{keyword}{const} uint32\_t kRecvTimeout = 100;  \textcolor{comment}{// ms}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20  \textcolor{keyword}{public}:}
\DoxyCodeLine{21   \textcolor{keyword}{enum} \{}
\DoxyCodeLine{22     MSG\_CO\_NMT\_CTRL = 0x000,  \textcolor{comment}{// CANOpen NMT Message REC}}
\DoxyCodeLine{23     MSG\_ODRIVE\_HEARTBEAT,}
\DoxyCodeLine{24     MSG\_ODRIVE\_ESTOP,}
\DoxyCodeLine{25     MSG\_GET\_MOTOR\_ERROR,  \textcolor{comment}{// Errors}}
\DoxyCodeLine{26     MSG\_GET\_ENCODER\_ERROR,}
\DoxyCodeLine{27     MSG\_GET\_SENSORLESS\_ERROR,}
\DoxyCodeLine{28     MSG\_SET\_AXIS\_NODE\_ID,}
\DoxyCodeLine{29     MSG\_SET\_AXIS\_REQUESTED\_STATE,}
\DoxyCodeLine{30     MSG\_SET\_AXIS\_STARTUP\_CONFIG,}
\DoxyCodeLine{31     MSG\_GET\_ENCODER\_ESTIMATES,}
\DoxyCodeLine{32     MSG\_GET\_ENCODER\_COUNT,}
\DoxyCodeLine{33     MSG\_SET\_CONTROLLER\_MODES,}
\DoxyCodeLine{34     MSG\_SET\_INPUT\_POS,}
\DoxyCodeLine{35     MSG\_SET\_INPUT\_VEL,}
\DoxyCodeLine{36     MSG\_SET\_INPUT\_TORQUE,}
\DoxyCodeLine{37     MSG\_SET\_LIMITS,}
\DoxyCodeLine{38     MSG\_START\_ANTICOGGING,}
\DoxyCodeLine{39     MSG\_SET\_TRAJ\_VEL\_LIMIT,}
\DoxyCodeLine{40     MSG\_SET\_TRAJ\_ACCEL\_LIMITS,}
\DoxyCodeLine{41     MSG\_SET\_TRAJ\_INERTIA,}
\DoxyCodeLine{42     MSG\_GET\_IQ,}
\DoxyCodeLine{43     MSG\_GET\_SENSORLESS\_ESTIMATES,}
\DoxyCodeLine{44     MSG\_RESET\_ODRIVE,}
\DoxyCodeLine{45     MSG\_GET\_BUS\_VOLTAGE\_CURRENT,}
\DoxyCodeLine{46     MSG\_CLEAR\_ERRORS,}
\DoxyCodeLine{47     MSG\_SET\_LINEAR\_COUNT,}
\DoxyCodeLine{48     MSG\_SET\_POS\_GAIN,}
\DoxyCodeLine{49     MSG\_SET\_VEL\_GAINS,}
\DoxyCodeLine{50     MSG\_GET\_ADC\_VOLTAGE,}
\DoxyCodeLine{51     MSG\_GET\_CONTROLLER\_ERROR,}
\DoxyCodeLine{52     MSG\_CO\_HEARTBEAT\_CMD = 0x700,  \textcolor{comment}{// CANOpen NMT Heartbeat  SEND}}
\DoxyCodeLine{53   \};}
\DoxyCodeLine{61   \mbox{\hyperlink{classhuron_1_1odrive_1_1ODriveCAN}{ODriveCAN}}(\mbox{\hyperlink{classhuron_1_1driver_1_1can_1_1BusBase}{huron::driver::can::BusBase}}* canbus,}
\DoxyCodeLine{62         uint32\_t axis\_id,}
\DoxyCodeLine{63         std::unique\_ptr<ODriveConfiguration> config,}
\DoxyCodeLine{64         uint32\_t get\_timeout = kGetTimeout);}
\DoxyCodeLine{65   \mbox{\hyperlink{classhuron_1_1odrive_1_1ODriveCAN}{ODriveCAN}}(\textcolor{keyword}{const} \mbox{\hyperlink{classhuron_1_1odrive_1_1ODriveCAN}{ODriveCAN}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{66   \mbox{\hyperlink{classhuron_1_1odrive_1_1ODriveCAN}{ODriveCAN}}\& operator=(\textcolor{keyword}{const} \mbox{\hyperlink{classhuron_1_1odrive_1_1ODriveCAN}{ODriveCAN}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{67   \textcolor{keyword}{virtual} \mbox{\hyperlink{classhuron_1_1odrive_1_1ODriveCAN}{\string~ODriveCAN}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{68 }
\DoxyCodeLine{69   \textcolor{comment}{// GenericComponent interface}}
\DoxyCodeLine{70   \textcolor{keywordtype}{void} SetUp() \textcolor{keyword}{override};}
\DoxyCodeLine{71   \textcolor{keywordtype}{void} Terminate() \textcolor{keyword}{override};}
\DoxyCodeLine{72 }
\DoxyCodeLine{73   \textcolor{comment}{// Get functions (msg.rtr bit must be set)}}
\DoxyCodeLine{74   \textcolor{keywordtype}{bool} GetMotorError(uint64\_t\& motor\_error) \textcolor{keyword}{override};}
\DoxyCodeLine{75   \textcolor{keywordtype}{bool} GetEncoderError(uint32\_t\& encoder\_error) \textcolor{keyword}{override};}
\DoxyCodeLine{76   \textcolor{keywordtype}{bool} GetControllerError(uint32\_t\& controller\_error) \textcolor{keyword}{override};}
\DoxyCodeLine{77   \textcolor{keywordtype}{bool} GetSensorlessError(uint32\_t\& sensorless\_error) \textcolor{keyword}{override};}
\DoxyCodeLine{78   \textcolor{keywordtype}{bool} GetEncoderEstimates(\textcolor{keywordtype}{float}\& pos, \textcolor{keywordtype}{float}\& vel) \textcolor{keyword}{override};}
\DoxyCodeLine{79   \textcolor{keywordtype}{bool} GetEncoderCount(int32\_t\& shadow\_cnt, int32\_t\& cnt\_cpr) \textcolor{keyword}{override};}
\DoxyCodeLine{80   \textcolor{keywordtype}{bool} GetIq(\textcolor{keywordtype}{float}\& iq\_setpoint, \textcolor{keywordtype}{float}\& iq\_measured) \textcolor{keyword}{override};}
\DoxyCodeLine{81   \textcolor{keywordtype}{bool} GetSensorlessEstimates(\textcolor{keywordtype}{float}\& pos, \textcolor{keywordtype}{float}\& vel) \textcolor{keyword}{override};}
\DoxyCodeLine{82   \textcolor{keywordtype}{bool} GetBusVoltageCurrent(\textcolor{keywordtype}{float}\& bus\_voltage, \textcolor{keywordtype}{float}\& bus\_current) \textcolor{keyword}{override};}
\DoxyCodeLine{83   \textcolor{comment}{// msg.rtr bit must NOT be set}}
\DoxyCodeLine{84   \textcolor{keywordtype}{bool} GetAdcVoltage(\textcolor{keywordtype}{float}\& adc\_voltage) \textcolor{keyword}{override};}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   \textcolor{comment}{// Set functions}}
\DoxyCodeLine{87   \textcolor{keywordtype}{bool} SetAxisNodeid(uint32\_t axis\_id) \textcolor{keyword}{override};}
\DoxyCodeLine{88   \textcolor{keywordtype}{bool} SetAxisRequestedState(uint32\_t state) \textcolor{keyword}{override};}
\DoxyCodeLine{89   \textcolor{keywordtype}{bool} SetAxisStartupConfig() \textcolor{keyword}{override};}
\DoxyCodeLine{90   \textcolor{keywordtype}{bool} SetInputPos(\textcolor{keywordtype}{float} input\_pos, int16\_t vel\_ff,}
\DoxyCodeLine{91            int16\_t torque\_ff) \textcolor{keyword}{override};}
\DoxyCodeLine{92   \textcolor{keywordtype}{bool} SetInputVel(\textcolor{keywordtype}{float} input\_vel, \textcolor{keywordtype}{float} torque\_ff) \textcolor{keyword}{override};}
\DoxyCodeLine{93   \textcolor{keywordtype}{bool} SetInputTorque(\textcolor{keywordtype}{float} input\_torque) \textcolor{keyword}{override};}
\DoxyCodeLine{94   \textcolor{keywordtype}{bool} SetControllerModes(int32\_t control\_mode, int32\_t input\_mode) \textcolor{keyword}{override};}
\DoxyCodeLine{95   \textcolor{keywordtype}{bool} SetLimits(\textcolor{keywordtype}{float} velocity\_limit, \textcolor{keywordtype}{float} current\_limit) \textcolor{keyword}{override};}
\DoxyCodeLine{96   \textcolor{keywordtype}{bool} SetTrajVelLimit(\textcolor{keywordtype}{float} traj\_vel\_limit) \textcolor{keyword}{override};}
\DoxyCodeLine{97   \textcolor{keywordtype}{bool} SetTrajAccelLimits(\textcolor{keywordtype}{float} traj\_accel\_limit,}
\DoxyCodeLine{98               \textcolor{keywordtype}{float} traj\_decel\_limit) \textcolor{keyword}{override};}
\DoxyCodeLine{99   \textcolor{keywordtype}{bool} SetTrajInertia(\textcolor{keywordtype}{float} traj\_inertia) \textcolor{keyword}{override};}
\DoxyCodeLine{100   \textcolor{keywordtype}{bool} SetLinearCount(int32\_t position) \textcolor{keyword}{override};}
\DoxyCodeLine{101   \textcolor{keywordtype}{bool} SetPosGain(\textcolor{keywordtype}{float} pos\_gain) \textcolor{keyword}{override};}
\DoxyCodeLine{102   \textcolor{keywordtype}{bool} SetVelGains(\textcolor{keywordtype}{float} vel\_gain, \textcolor{keywordtype}{float} vel\_interator\_gain) \textcolor{keyword}{override};}
\DoxyCodeLine{103 }
\DoxyCodeLine{104   \textcolor{comment}{// Other functions}}
\DoxyCodeLine{105   \textcolor{keywordtype}{bool} Nmt() \textcolor{keyword}{override};}
\DoxyCodeLine{106   \textcolor{keywordtype}{bool} Estop() \textcolor{keyword}{override};}
\DoxyCodeLine{107   \textcolor{keywordtype}{bool} ClearErrors() \textcolor{keyword}{override};}
\DoxyCodeLine{108   \textcolor{keywordtype}{bool} StartAnticogging() \textcolor{keyword}{override};}
\DoxyCodeLine{109 }
\DoxyCodeLine{110   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} uint8\_t NUM\_NODE\_ID\_BITS = 6;}
\DoxyCodeLine{111   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} uint8\_t NUM\_CMD\_ID\_BITS = 11 -\/ NUM\_NODE\_ID\_BITS;}
\DoxyCodeLine{112 }
\DoxyCodeLine{113   \textcolor{comment}{// Utility functions}}
\DoxyCodeLine{114   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} uint32\_t GetNodeId(uint32\_t msgID) \{}
\DoxyCodeLine{115     \textcolor{keywordflow}{return} (msgID >> NUM\_CMD\_ID\_BITS);  \textcolor{comment}{// Upper 6 or more bits}}
\DoxyCodeLine{116   \}}
\DoxyCodeLine{117 }
\DoxyCodeLine{118   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} uint8\_t GetCmdId(uint32\_t msgID) \{}
\DoxyCodeLine{119     \textcolor{keywordflow}{return} (msgID \& 0x01F);  \textcolor{comment}{// Bottom 5 bits}}
\DoxyCodeLine{120   \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122  \textcolor{keyword}{private}:}
\DoxyCodeLine{123   \mbox{\hyperlink{classhuron_1_1driver_1_1can_1_1BusBase}{huron::driver::can::BusBase}}* canbus\_;}
\DoxyCodeLine{124   uint32\_t can\_id\_;}
\DoxyCodeLine{125   uint32\_t axis\_id\_;}
\DoxyCodeLine{126   \textcolor{keywordtype}{bool} is\_ext\_ = \textcolor{keyword}{false};}
\DoxyCodeLine{127 \};}
\DoxyCodeLine{128 }
\DoxyCodeLine{129 \}  \textcolor{comment}{// namespace odrive}}
\DoxyCodeLine{130 \}  \textcolor{comment}{// namespace huron}}

\end{DoxyCode}
